#!/usr/bin/env node

'use strict';

import assert from 'assert';
import yargs from 'yargs';
import binHelper from '../bin-helper';
import getOptions from 'mocha/bin/options';

// support --opts
// getOptions() changes process.argv
getOptions();

const argv = yargs.parse(process.argv);
assert(argv._.length > 2, 'No test files found');

binHelper(argv).then((failsOccured) => {
    // wait for reporter to finish its operations
    // exit with code equal to number of failed tests
    process.nextTick(() => process.exit(failsOccured));
});
